!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){"use strict";function i(e){var i=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/,t=e.match(i);return t&&11==t[7].length?t[7]:!1}function t(i,a){this.$element=e(i),this.options=e.extend({},t.DEFAULTS,e.isPlainObject(a)&&a),this.init()}var a="qor.medialibrary.action",o="enable."+a,n="disable."+a,r="keyup."+a,d="switched.qor.tabbar.radio",s='[data-toggle="qor.tab.radio"]',l="reload.qor.bottomsheets",f='[name="QorResource.SelectedType"]',c='[data-tab-source="video_link"]',u=".qor-video__link",h=".qor-medialibrary__video-link",m=".qor-medialibrary__video",b=".qor-medialibrary__desc",v=".qor-file__options",p=".qor-bottomsheets__mediabox",g='input[name="QorResource.MediaOption"]';return t.prototype={constructor:t,init:function(){this.bind(),this.initMedia()},bind:function(){e(document).on(d,s,this.resetMediaData.bind(this)).on(r,u,this.setVideo.bind(this)).on(r,b,this.setImageDesc.bind(this)).on(l,p,this.initMedia.bind(this,"bottomsheet"))},unbind:function(){e(document).off(d,s,this.resetMediaData.bind(this)).off(r,u,this.setVideo.bind(this)).off(r,b,this.setImageDesc.bind(this))},setMediaData:function(e,i){var t=e.find(v),a=e.find(g);t.val(JSON.stringify(i)),a.val(JSON.stringify(i))},setImageDesc:function(i){var t,a,o=e(i.target),n=o.closest("form");t=n.find(v),a=JSON.parse(t.val()),a.Description=o.val(),this.setMediaData(n,a)},initMedia:function(t){var a=e(m),o=e(h);t&&(a=e(p).find(m),o=e(p).find(h)),(a.size()||o.size())&&(a.each(function(){var i=e(this),t=i.data("videolink"),a=t&&t.match(/\.mp4$|\.m4p$|\.m4v$|\.m4v$|\.mov$|\.mpeg$|\.webm$|\.avi$|\.ogg$|\.ogv$/);a&&i.parent().addClass("qor-table--video qor-table--video-internal").html('<video width=100% height=100% controls><source src="'+t+'"></video>')}),o.each(function(){var t=e(this),a=t.data("videolink"),o=i(a);o&&t.parent().addClass("qor-table--video qor-table--video-external").html('<iframe width="100%" height="100%" src="//www.youtube.com/embed/'+o+'?rel=0" frameborder="0" allowfullscreen></iframe>')}))},setVideo:function(t){var a=e(t.target),o=a.closest("[data-tab-source]"),n=a.closest("form"),r=n.find(v),d=JSON.parse(r.val()),s=a.val(),l=o.find("iframe"),f=i(s);d.SelectedType="video_link",d.Video=s,this.setMediaData(n,d),f&&(l.length&&l.remove(),o.append('<iframe width="100%" height="400" src="//www.youtube.com/embed/'+i(s)+'?rel=0" frameborder="0" allowfullscreen></iframe>'))},resetMediaData:function(i,t,a){var o=e(t),n=o.closest("form"),r=o.find(v),d=o.find(c).find(".qor-fieldset__alert"),s=JSON.parse(r.val());s.SelectedType=a,"video_link"==a&&(s.Video=o.find(u).val(),d.length&&d.remove()),s.Description=e('[data-tab-source="'+a+'"]').find(b).val(),e(f).val(a),this.setMediaData(n,s)},destroy:function(){this.unbind()}},t.DEFAULTS={},e.fn.qorSliderAfterShow=e.fn.qorSliderAfterShow||{},e.fn.qorSliderAfterShow.renderMediaVideo=function(){var t=e(c),a=e(b),o=t.length&&t.data().videourl;a.length&&a.val(a.data().imageInfo.Description),t.length&&o&&t.append('<iframe width="100%" height="400" src="//www.youtube.com/embed/'+i(o)+'?rel=0&fs=0&modestbranding=1&disablekb=1" frameborder="0" allowfullscreen></iframe>')},t.plugin=function(i){return this.each(function(){var o,n=e(this),r=n.data(a);if(!r){if(/destroy/.test(i))return;n.data(a,r=new t(this,i))}"string"==typeof i&&e.isFunction(o=r[i])&&o.apply(r)})},e(function(){var i=".qor-table--medialibrary";e(document).on(n,function(a){t.plugin.call(e(i,a.target),"destroy")}).on(o,function(a){t.plugin.call(e(i,a.target))}).triggerHandler(o)}),t});